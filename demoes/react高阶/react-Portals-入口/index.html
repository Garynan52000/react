<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <script src="../build/react.development.js"></script>
    <script src="../build/react-dom.development.js"></script>
    <script src="../build/babel.min.js"></script>
    <script src="../build/jquery.min.js"></script>

    <!-- 样式 -->
    <link rel="stylesheet" href="./index.css">
  </head>
  <body>
    <!-- 主页入口 -->
    <div id="root"></div>
    <!-- 弹框组建入口 -->
    <div id="modal-root"></div>

    <script type="text/babel">
      /* # Portals 入口 */
      /* 表述： 将子节点渲染到父组件以外的 DOM 节点。 */
      /* 例子： 弹框组件 Modal */

      /* 样式配置 */
      const backDrop = {
        zIndex: 999,
      }
      const header = {
        height: '35px',
        lineHeight: '35px',
      }
      const footer = {
        height: '35px',
        lineHeight: '35px',
      }
      const container = {
        zIndex: backDrop.zIndex + 1,
        height: '300px',
        paddingTop: header.height,
        paddingBottom: footer.height,
      }
      const body = {
        top: header.height,
        bottom: footer.height,
      }
      const ModalStyleConf = {
        backDrop,
        container,
        body,
        header,
        footer,
      }
      
      /* 基础模态框组建 */
      class Modal extends React.Component {
        constructor(porps) {
          super(porps);
          this.insertEl = document.getElementById('modal-root');
        }

        render() {
          const { header, footer, styleConf, isShow, children } = this.props;
          const style = Object.assign({}, styleConf);
          style.backDrop = Object.assign({}, style.backDrop, {display: isShow? 'block' : 'none'});
          style.container = Object.assign({}, style.container, {display: isShow? 'block' : 'none'});
          
          return ReactDOM.createPortal(
            <React.Fragment>
              <div className="modal-container" style={style.backDrop}
              onClick={(_e) => this.props.toggleShow(_e, false)}>
              </div>

              <article className="modal" style={style.container}>
                <header style={style.header}>
                  {header}
                  <i onClick={(_e) => this.props.toggleShow(_e, false)}>X</i>
                </header>
                <section style={style.body}>
                  <div>{children}</div>
                </section>
                <footer style={style.footer}>{footer}</footer>
              </article>
            </React.Fragment>
          , this.insertEl);
        }
      }
      /* Modal props 默认值 */
      Modal.defaultProps = {
        isShow: false,  // 控制显示性
        header: 'Header',  // 头部 template
        footer: 'Footer',  // 下脚 template
        styleConf: ModalStyleConf,  // 样式配置
        toggleShow(_isShow) {},  // 切换可视化
      }

      /* App */
      class App extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            isModalShow: false,
          }

          this.togleModalShow = this.togleModalShow.bind(this);
        }

        /* 切换模态框可实现 */
        togleModalShow(_event, _isShow) {
          if (_isShow === undefined) this.setState(preState => {
            return {isModalShow: !preState.isModalShow}
          });
          else this.setState({isModalShow: !!_isShow});
        }

        render() {
          const { isModalShow } = this.state;
          
          return (
            <article>
              <h1>Hello World!</h1>  
              <button onClick={this.togleModalShow}>
                { this.state.isModalShow? 'hideModal' : 'showModal' }
              </button>
              <Modal header="modal-header" footer="modal-footer" 
              isShow={isModalShow}
              toggleShow={this.togleModalShow}>
                modal-body
              </Modal>
            </article>
          );
        }
      }


      ReactDOM.render(
        <App />,
        document.getElementById('root')
      );
    </script>
  </body>
</html>
